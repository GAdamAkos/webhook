<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhatsApp √úzenetk√ºld≈ë</title>
  <style>
    :root {
      --bg: #ffffff;
      --text: #111;
      --accent: #26a69a;
      --input: #f0f0f0;
      --border: #ccc;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #1e1e1e;
        --text: #eee;
        --accent: #26a69a;
        --input: #2c2c2c;
        --border: #444;
      }
    }

    [data-theme="dark"] {
      --bg: #1e1e1e;
      --text: #eee;
      --input: #2c2c2c;
      --border: #444;
    }

    [data-theme="light"] {
      --bg: #ffffff;
      --text: #111;
      --input: #f0f0f0;
      --border: #ccc;
    }

    * {
      box-sizing: border-box;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 2rem;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      transition: background 0.3s, color 0.3s;
    }

    .container {
      background: var(--bg);
      border: 1px solid var(--border);
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      max-width: 500px;
      width: 100%;
    }

    h1 {
      text-align: center;
      color: var(--accent);
      margin-bottom: 1rem;
    }

    label {
      margin-top: 1rem;
      display: block;
      font-weight: 500;
    }

    input, textarea, select {
      width: 100%;
      padding: 0.75rem;
      margin-top: 0.3rem;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      background: var(--input);
      color: var(--text);
      font-size: 1rem;
    }

    input[type="file"] {
      padding: 0.4rem;
    }

    button {
      width: 100%;
      padding: 0.75rem;
      margin-top: 1.5rem;
      font-size: 1rem;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    }

    button:hover {
      background: #00796b;
    }

    #status {
      margin-top: 1rem;
      font-weight: 500;
      text-align: center;
    }

    .history {
      margin-top: 2rem;
    }

    .history h2 {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .history ul {
      list-style: none;
      padding-left: 0;
    }

    .history li {
      padding: 0.5rem;
      border-bottom: 1px solid var(--border);
      font-size: 0.95rem;
    }

    .theme-toggle {
      text-align: right;
      margin-bottom: 1rem;
    }

    .theme-toggle button {
      background: none;
      border: none;
      color: var(--accent);
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container" id="app">
    <div class="theme-toggle">
      <button onclick="toggleTheme()">üåì T√©ma v√°lt√°sa</button>
    </div>

    <h1>üì® WhatsApp √úzenetk√ºld≈ë</h1>

    <label for="name">N√©v (opcion√°lis):</label>
    <input type="text" id="name" placeholder="Pl. G√°bor" />

    <label for="phone">Telefonsz√°m (+36...):</label>
    <input type="text" id="phone" placeholder="+36123456789" />

    <label for="template">√úzenet sablon:</label>
    <select id="template">
      <option value="">-- V√°lassz sablont --</option>
      <option value="Szia! Hogy vagy?">Szia! Hogy vagy?</option>
      <option value="K√©rlek, h√≠vj vissza!">K√©rlek, h√≠vj vissza!</option>
      <option value="K√ºld√∂m, amit megbesz√©lt√ºnk.">K√ºld√∂m, amit megbesz√©lt√ºnk.</option>
    </select>

    <label for="message">Egyedi √ºzenet:</label>
    <textarea id="message" rows="4" placeholder="√çrd be az √ºzenetet..."></textarea>

    <label for="file">F√°jl vagy k√©p csatol√°sa:</label>
    <input type="file" id="file" accept="image/*,application/pdf" />

    <button id="sendBtn">√úzenet k√ºld√©se</button>

    <div id="status"></div>

    <div class="history">
      <h2>üìú El≈ëzm√©nyek</h2>
      <ul id="historyList"></ul>
    </div>
  </div>

  <script>
    const sendBtn = document.getElementById('sendBtn');
    const statusDiv = document.getElementById('status');
    const templateSelect = document.getElementById('template');
    const historyList = document.getElementById('historyList');

    function toggleTheme() {
      const current = document.body.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    }

    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        document.body.setAttribute('data-theme', savedTheme);
      }
    });

    templateSelect.addEventListener('change', () => {
      const msgBox = document.getElementById('message');
      if (!msgBox.value.trim()) {
        msgBox.value = templateSelect.value;
      }
    });

    sendBtn.addEventListener('click', () => {
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const message = document.getElementById('message').value.trim();
      const fileInput = document.getElementById('file');

      if (!phone || (!message && fileInput.files.length === 0)) {
        statusDiv.textContent = 'üìõ K√©rlek, t√∂lts ki minden sz√ºks√©ges mez≈ët vagy adj meg f√°jlt!';
        statusDiv.style.color = 'crimson';
        return;
      }

      const fullMessage = name ? `*${name}*\n\n${message}` : message;

      statusDiv.textContent = 'üì§ √úzenet k√ºld√©se folyamatban...';
      statusDiv.style.color = '#777';

      const formData = new FormData();
      formData.append('phone', phone);
      formData.append('message', fullMessage);

      if (fileInput.files.length > 0) {
        formData.append('file', fileInput.files[0]);
      }

      const endpoint = fileInput.files.length > 0 ? '/send-file-message' : '/send-message';

      fetch(endpoint, {
        method: 'POST',
        body: formData,
      })
        .then(res => res.json())
        .then(data => {
          statusDiv.textContent = data.message || '‚úÖ √úzenet elk√ºldve!';
          statusDiv.style.color = 'green';
          updateHistory(phone, fullMessage + (fileInput.files.length > 0 ? ' üìé [f√°jl]' : ''));
        })
        .catch(err => {
          console.error(err);
          statusDiv.textContent = '‚ùå Hiba t√∂rt√©nt az √ºzenetk√ºld√©s sor√°n.';
          statusDiv.style.color = 'crimson';
        });
    });

    function updateHistory(phone, message) {
      const li = document.createElement('li');
      const now = new Date().toLocaleTimeString();
      li.textContent = `[${now}] ${phone} ‚Üí ${message}`;
      historyList.prepend(li);
    }
  </script>
</body>
</html>
