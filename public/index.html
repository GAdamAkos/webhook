<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhatsApp √úzenetk√ºld≈ë</title>
  <style>
    :root {
      --bg: #ffffff;
      --text: #111;
      --accent: #26a69a;
      --input: #f0f0f0;
      --border: #ccc;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #1e1e1e;
        --text: #eee;
        --accent: #26a69a;
        --input: #2c2c2c;
        --border: #444;
      }
    }

    [data-theme="dark"] {
      --bg: #1e1e1e;
      --text: #eee;
      --input: #2c2c2c;
      --border: #444;
    }

    [data-theme="light"] {
      --bg: #ffffff;
      --text: #111;
      --input: #f0f0f0;
      --border: #ccc;
    }

    * {
      box-sizing: border-box;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 2rem;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      transition: background 0.3s, color 0.3s;
    }

    .container {
      background: linear-gradient(135deg, #ffffff 0%, #e0f7f5 100%);
      border-radius: 1.25rem;
      box-shadow: 0 12px 30px rgba(38, 166, 154, 0.25);
      padding: 2.5rem;
      max-width: 600px;
      width: 100%;
      transition: background 0.3s ease, box-shadow 0.3s ease;
    }

    [data-theme="dark"] .container {
      background: linear-gradient(135deg, #2c2c2c 0%, #1a4034 100%);
      box-shadow: 0 12px 30px rgba(38, 166, 154, 0.8);
    }

    h1 {
      text-align: center;
      color: var(--accent);
      margin-bottom: 1rem;
    }

    label {
      margin-top: 1rem;
      display: block;
      font-weight: 500;
    }

    input, textarea, select {
      width: 100%;
      padding: 0.75rem;
      margin-top: 0.3rem;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      background: var(--input);
      color: var(--text);
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    input:focus, textarea:focus, select:focus {
      border-color: var(--accent);
      outline: none;
      box-shadow: 0 0 6px var(--accent);
    }

    input[type="file"] {
      padding: 0.4rem;
    }

    button {
      width: 100%;
      padding: 0.75rem;
      margin-top: 1.5rem;
      font-size: 1rem;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover:not(:disabled) {
      background-color: #00796b;
    }

    button:disabled {
      background-color: #a2d2cd;
      cursor: not-allowed;
    }

    #status {
      opacity: 0;
      transition: opacity 0.4s ease;
      font-weight: 600;
      margin-top: 1rem;
      text-align: center;
    }

    #status.show {
      opacity: 1;
    }

    .history {
      margin-top: 2rem;
    }

    .history h2 {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .history ul {
      list-style: none;
      padding-left: 0;
    }

    .history li {
      padding: 0.5rem;
      border-bottom: 1px solid var(--border);
      font-size: 0.95rem;
    }

    .theme-toggle {
      text-align: right;
      margin-bottom: 1rem;
    }

    .theme-toggle button {
      background: none;
      border: 2px solid var(--accent);
      border-radius: 1.5rem;
      padding: 0.3rem 1rem;
      font-weight: 700;
      font-size: 1rem;
      color: var(--accent);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .theme-toggle button:hover {
      background-color: var(--accent);
      color: white;
    }

    /* File preview */
    #filePreview {
      margin-top: 0.75rem;
      font-size: 0.9rem;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    #filePreview img {
      max-height: 60px;
      max-width: 60px;
      object-fit: contain;
      border-radius: 0.5rem;
      border: 1px solid var(--border);
    }
  </style>
</head>
<body>
  <div class="container" id="app">
    <div class="theme-toggle">
      <button type="button" id="themeToggleBtn">üåì T√©ma v√°lt√°sa</button>
    </div>

    <h1>üì® WhatsApp √úzenetk√ºld≈ë</h1>

    <label for="name">N√©v (opcion√°lis):</label>
    <input type="text" id="name" placeholder="Pl. G√°bor" />

    <label for="phone">Telefonsz√°m (+36-tal kezdve, 9-10 sz√°mjegy):</label>
    <input type="text" id="phone" placeholder="+36-tal kezdve, 9-10 sz√°mjegy" />

    <label for="templateType">Sablon t√≠pusa:</label>
    <select id="templateType">
      <option value="text">Egyszer≈± sz√∂veges sablon</option>
      <option value="whatsapp">WhatsApp API sablon</option>
    </select>

    <label for="template">√úzenet sablon:</label>
    <select id="template">
      <option value="">-- V√°lassz sablont --</option>
    </select>

    <div id="templateParams"></div>

    <label for="message">Egyedi √ºzenet:</label>
    <textarea id="message" rows="4" placeholder="√çrd be az √ºzenetet..."></textarea>

    <label for="file">F√°jl vagy k√©p csatol√°sa:</label>
    <input type="file" id="file" accept="image/*,application/pdf" />
    <div id="filePreview"></div>

    <button id="sendBtn" disabled>√úzenet k√ºld√©se</button>

    <div id="status"></div>

    <div class="history">
      <h2>üìú El≈ëzm√©nyek</h2>
      <ul id="historyList"></ul>
    </div>
  </div>

  <script>
    const textTemplates = {
      "Szia! Hogy vagy?": "Szia! Hogy vagy?",
      "K√©rlek, h√≠vj vissza!": "K√©rlek, h√≠vj vissza!",
      "K√ºld√∂m, amit megbesz√©lt√ºnk.": "K√ºld√∂m, amit megbesz√©lt√ºnk."
    };

    let whatsappTemplates = {}; // majd dinamikusan t√∂ltj√ºk

    const templateTypeSelect = document.getElementById('templateType');
    const templateSelect = document.getElementById('template');
    const messageBox = document.getElementById('message');
    const templateParamsDiv = document.getElementById('templateParams');
    const sendBtn = document.getElementById('sendBtn');
    const statusDiv = document.getElementById('status');
    const historyList = document.getElementById('historyList');
    const phoneInput = document.getElementById('phone');
    const fileInput = document.getElementById('file');
    const filePreview = document.getElementById('filePreview');
    const themeToggleBtn = document.getElementById('themeToggleBtn');

    function toggleTheme() {
      const current = document.body.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      updateThemeToggleButton();
    }

    function updateThemeToggleButton() {
      const current = document.body.getAttribute('data-theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      if (current === 'dark') {
        themeToggleBtn.textContent = 'üåû Vil√°gos m√≥d';
      } else {
        themeToggleBtn.textContent = 'üåô S√∂t√©t m√≥d';
      }
    }

    function updateTemplateOptions() {
      const type = templateTypeSelect.value;
      templateSelect.innerHTML = '<option value="">-- V√°lassz sablont --</option>';
      messageBox.style.display = type === "text" ? "block" : "none";
      templateParamsDiv.innerHTML = "";

      const templates = type === "text" ? textTemplates : whatsappTemplates;
      for (const key in templates) {
        const opt = document.createElement('option');
        opt.value = key;
        opt.textContent = key;
        templateSelect.appendChild(opt);
      }
    }

    function clearTemplateParams() {
      templateParamsDiv.innerHTML = "";
    }

    function createParamInput(name, placeholder) {
      const label = document.createElement('label');
      label.textContent = name + ":";
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = placeholder || "";
      input.name = name;
      input.style.marginBottom = '0.8rem';
      input.required = true;
      input.classList.add('param-input');
      return {label, input};
    }

    function updateTemplateParams() {
      templateParamsDiv.innerHTML = "";

      if (templateTypeSelect.value !== "whatsapp") return;

      const selected = templateSelect.value;
      if (!selected || !whatsappTemplates[selected]) return;

      const template = whatsappTemplates[selected];
      if (!template.components) return;

      // Csak body komponens param√©tereit n√©zz√ºk
      const body = template.components.find(c => c.type === "BODY");
      if (!body || !body.parameters) return;

      body.parameters.forEach((param, idx) => {
        const {label, input} = createParamInput(param.name || `Param√©ter ${idx + 1}`, param.example || "");
        templateParamsDiv.appendChild(label);
        templateParamsDiv.appendChild(input);
      });
    }

    async function loadWhatsAppTemplates() {
      // Ez egy p√©lda URL, cser√©ld ki a saj√°todra vagy t√∂ltsd be API-b√≥l
      const url = 'https://raw.githubusercontent.com/fake/whatsapp-templates.json';
      try {
        // K√≠s√©rleti API h√≠v√°s helyett, teszt adat
        whatsappTemplates = {
          "√údv√∂zl≈ë √ºzenet": {
            name: "√údv√∂zl≈ë √ºzenet",
            components: [
              {
                type: "BODY",
                parameters: [
                  {name: "N√©v", example: "J√°nos"},
                  {name: "D√°tum", example: "2025-07-23"}
                ]
              }
            ]
          },
          "Megrendel√©s visszaigazol√°s": {
            name: "Megrendel√©s visszaigazol√°s",
            components: [
              {
                type: "BODY",
                parameters: [
                  {name: "Rendel√©si sz√°m", example: "123456"},
                  {name: "√ñsszeg", example: "5000 Ft"}
                ]
              }
            ]
          }
        };
      } catch (e) {
        console.error('Hiba a WhatsApp sablonok bet√∂lt√©s√©n√©l:', e);
        whatsappTemplates = {};
      }
      updateTemplateOptions();
    }

    function updateMessageFromTemplate() {
      const type = templateTypeSelect.value;
      const selected = templateSelect.value;
      if (type === "text") {
        messageBox.value = textTemplates[selected] || "";
      } else {
        messageBox.value = "";
      }
      updateTemplateParams();
      validateForm();
    }

    function validatePhone(phone) {
      const re = /^\+36\d{9,10}$/;
      return re.test(phone.trim());
    }

    function validateForm() {
      const phoneVal = phoneInput.value.trim();
      const isPhoneValid = validatePhone(phoneVal);
      let allParamsFilled = true;

      if (templateTypeSelect.value === "whatsapp") {
        const paramInputs = templateParamsDiv.querySelectorAll('input.param-input');
        paramInputs.forEach(input => {
          if (!input.value.trim()) allParamsFilled = false;
        });
      }

      sendBtn.disabled = !(isPhoneValid && allParamsFilled);
    }

    function showStatus(text, color='green') {
      statusDiv.textContent = text;
      statusDiv.style.color = color;
      statusDiv.classList.add('show');
      clearTimeout(statusDiv._timeout);
      statusDiv._timeout = setTimeout(() => {
        statusDiv.classList.remove('show');
      }, 5000);
    }

    function updateHistory(phone, message) {
      const li = document.createElement('li');
      const dateStr = new Date().toLocaleString();
      li.textContent = `[${dateStr}] ${phone}: ${message}`;
      historyList.prepend(li);
    }

    function buildWhatsAppMessage(template, params) {
      let message = template;
      for (const key in params) {
        const re = new RegExp(`{{${key}}}`, 'g');
        message = message.replace(re, params[key]);
      }
      return message;
    }

    function sendMessage() {
      const phone = phoneInput.value.trim();
      let message = messageBox.value.trim();

      if (templateTypeSelect.value === 'whatsapp') {
        // Sablon param√©tereket √∂sszeszedj√ºk
        const paramInputs = templateParamsDiv.querySelectorAll('input.param-input');
        const params = {};
        paramInputs.forEach(input => {
          params[input.name] = input.value.trim();
        });

        // Egyszer≈± helyettes√≠t√©s {{Param√©ter neve}} a sablon sz√∂veg√©ben
        const templateData = whatsappTemplates[templateSelect.value];
        if (!templateData) {
          showStatus('Nem tal√°lhat√≥ sablon!', 'red');
          return;
        }

        // Itt csak egyszer≈± helyettes√≠t√©s, teszt jelleggel:
        // P√©lda sablon sz√∂veg, amit helyettes√≠t√ºnk:
        let templateString = "Szia {{N√©v}}, k√∂sz√∂nj√ºk a rendel√©st {{D√°tum}}-√°n!";
        if (templateData.components) {
          // Ha van body √©s parameters, akkor k√©zzel √∂ssze√°ll√≠tunk sz√∂veget
          templateString = "√údv√∂zlet {{N√©v}}! A rendel√©sed d√°tuma: {{D√°tum}}.";
          if(templateSelect.value === "Megrendel√©s visszaigazol√°s") {
            templateString = "Kedves {{N√©v}}, a rendel√©si sz√°mod: {{Rendel√©si sz√°m}}, √∂sszeg: {{√ñsszeg}}.";
          }
        }
        message = buildWhatsAppMessage(templateString, params);
        messageBox.value = message;
      }

      // Ellen≈ërizz√ºk a f√°jlt, ha van
      let fileData = null;
      if (fileInput.files.length > 0) {
        fileData = fileInput.files[0];
      }

      // Itt j√∂nne az API h√≠v√°s vagy WhatsApp link megnyit√°sa
      // P√©ld√°ul a k√∂vetkez≈ë URL-el (WhatsApp Web link):
      const waURL = `https://wa.me/${phone.replace(/\D/g, '')}?text=${encodeURIComponent(message)}`;
      window.open(waURL, '_blank');

      showStatus("√úzenet elk√ºldve!", "green");
      updateHistory(phone, message);

      // T√∂r√∂lj√ºk az inputokat
      //messageBox.value = "";
      //fileInput.value = "";
      filePreview.innerHTML = "";
      sendBtn.disabled = true;
    }

    // File preview
    fileInput.addEventListener('change', () => {
      filePreview.innerHTML = '';
      if (fileInput.files.length === 0) return;

      const file = fileInput.files[0];
      const fileNameSpan = document.createElement('span');
      fileNameSpan.textContent = `F√°jl kiv√°lasztva: ${file.name}`;
      filePreview.appendChild(fileNameSpan);

      if (file.type.startsWith('image/')) {
        const img = document.createElement('img');
        img.src = URL.createObjectURL(file);
        img.onload = () => URL.revokeObjectURL(img.src);
        filePreview.appendChild(img);
      }
      validateForm();
    });

    phoneInput.addEventListener('input', validateForm);
    templateTypeSelect.addEventListener('change', () => {
      updateTemplateOptions();
      validateForm();
    });
    templateSelect.addEventListener('change', () => {
      updateMessageFromTemplate();
      validateForm();
    });

    templateParamsDiv.addEventListener('input', validateForm);

    sendBtn.addEventListener('click', sendMessage);

    themeToggleBtn.addEventListener('click', toggleTheme);

    // Init
    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) document.body.setAttribute('data-theme', savedTheme);
      else {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.body.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
      }
      updateThemeToggleButton();
      loadWhatsAppTemplates();
      validateForm();
    });
  </script>
</body>
</html>
